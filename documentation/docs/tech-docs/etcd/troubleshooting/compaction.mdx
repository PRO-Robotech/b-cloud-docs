---
id: compaction
toc_min_heading_level: 2
toc_max_heading_level: 2
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'
import dedent from 'ts-dedent'
import CodeBlock from '@theme/CodeBlock'

# 5.1.5.4.1. Уплотнение (Compaction)

> Уплотнение в etcd – это процесс удаления старых версий данных (ревизий) из хранилища. В etcd все операции записи создают новые ревизии ключей, позволяя клиентам получать доступ к историческим данным. Однако, со временем, накопление этих ревизий приводит к увеличению объема используемого дискового пространства и замедлению работы кластера.

## 5.1.5.4.1.1. Как работает

- Уплотнение может быть запущено автоматически на основе политики (например, по времени или числу ревизий) или вручную, с помощью команды etcdctl compact.

- Во время уплотнения etcd удаляет ревизии, которые старше указанного индекса ревизии. Это означает, что клиентам больше недоступны данные до этого индекса.

- Обновляются внутренние структуры данных, чтобы отразить удаление старых ревизий.

## 5.1.5.4.1.2. Предпосылки

- При интенсивных операциях записи и удаления в etcd быстро накапливаются исторические ревизии.

- Без уплотнения размер базы данных будет постоянно расти, что может привести к исчерпанию дискового пространства.

- Слишком большое количество ревизий может замедлить работу etcd, особенно при выполнении запросов к историческим данным.

## 5.1.5.4.1.3. Инструкция

:::warning
Просьба обратить внимание, что есть внешняя зависимость от alias.
:::

<Tabs groupId="install-type">

  <TabItem value='etcdctl'>
    <CodeBlock language="bash">
      {dedent`
        etcdctlCompaction
      `}
    </CodeBlock>
  </TabItem>

  <TabItem value='ectl'>
    <CodeBlock language="bash">
      {dedent`
        ectlCompaction
      `}
    </CodeBlock>
  </TabItem>

  <TabItem value='nectl'>
    <CodeBlock language="bash">
      {dedent`
        nectlCompaction
      `}
    </CodeBlock>
  </TabItem>

</Tabs>

:::note Вывод команды

> При удачном выполнении команды получим следующего вида сообщение.

<CodeBlock language="bash">
  {dedent`
    compacted revision 75704
  `}
</CodeBlock>

:::
